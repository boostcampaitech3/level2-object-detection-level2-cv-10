# Level2 P-stage: Object Detection #ëˆˆ#ì‚¬ëŒ
<img src="https://user-images.githubusercontent.com/71958885/164018511-7474616a-e5c4-421e-b28a-5b35fb43b726.png" width="200" height="200" />

<br>

## Members
* ê¹€í•˜ì¤€ T3066
* ì†¡ë¯¼ìˆ˜ T3113
* ì‹¬ì¤€êµ T3124
* ìœ ìŠ¹ë¦¬ T3129
* ì´ì°½ì§„ T3169
* ì „ì˜ìš° T3192
<br>

## Mentor
* ê°•ì²œì„± ë©˜í† ë‹˜
<br>

## Competition : ì¬í™œìš© í’ˆëª© ë¶„ë¥˜ë¥¼ ìœ„í•œ Object Detection
ë°”ì•¼íë¡œ ëŒ€ëŸ‰ ìƒì‚°, ëŒ€ëŸ‰ ì†Œë¹„ì˜ ì‹œëŒ€. ìš°ë¦¬ëŠ” ë§ì€ ë¬¼ê±´ì´ ëŒ€ëŸ‰ìœ¼ë¡œ ìƒì‚°ë˜ê³ , ì†Œë¹„ë˜ëŠ” ì‹œëŒ€ë¥¼ ì‚´ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŸ¬í•œ ë¬¸í™”ëŠ” 'ì“°ë ˆê¸° ëŒ€ë€', 'ë§¤ë¦½ì§€ ë¶€ì¡±'ê³¼ ê°™ì€ ì—¬ëŸ¬ ì‚¬íšŒ ë¬¸ì œë¥¼ ë‚³ê³  ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/71958885/164008385-32e7e2c7-e8d3-4661-bcc5-9775910a21a8.png)

ë¶„ë¦¬ìˆ˜ê±°ëŠ” ì´ëŸ¬í•œ í™˜ê²½ ë¶€ë‹´ì„ ì¤„ì¼ ìˆ˜ ìˆëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì˜ ë¶„ë¦¬ë°°ì¶œ ëœ ì“°ë ˆê¸°ëŠ” ìì›ìœ¼ë¡œì„œ ê°€ì¹˜ë¥¼ ì¸ì •ë°›ì•„ ì¬í™œìš©ë˜ì§€ë§Œ, ì˜ëª» ë¶„ë¦¬ë°°ì¶œ ë˜ë©´ ê·¸ëŒ€ë¡œ íê¸°ë¬¼ë¡œ ë¶„ë¥˜ë˜ì–´ ë§¤ë¦½ ë˜ëŠ” ì†Œê°ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë”°ë¼ì„œ ìš°ë¦¬ëŠ” ì‚¬ì§„ì—ì„œ ì“°ë ˆê¸°ë¥¼ Detection í•˜ëŠ” ëª¨ë¸ì„ ë§Œë“¤ì–´ ì´ëŸ¬í•œ ë¬¸ì œì ì„ í•´ê²°í•´ë³´ê³ ì í•©ë‹ˆë‹¤. ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ë°ì´í„°ì…‹ìœ¼ë¡œëŠ” ì¼ë°˜ ì“°ë ˆê¸°, í”Œë¼ìŠ¤í‹±, ì¢…ì´, ìœ ë¦¬ ë“± 10 ì¢…ë¥˜ì˜ ì“°ë ˆê¸°ê°€ ì°íŒ ì‚¬ì§„ ë°ì´í„°ì…‹ì´ ì œê³µë©ë‹ˆë‹¤.

ì—¬ëŸ¬ë¶„ì— ì˜í•´ ë§Œë“¤ì–´ì§„ ìš°ìˆ˜í•œ ì„±ëŠ¥ì˜ ëª¨ë¸ì€ ì“°ë ˆê¸°ì¥ì— ì„¤ì¹˜ë˜ì–´ ì •í™•í•œ ë¶„ë¦¬ìˆ˜ê±°ë¥¼ ë•ê±°ë‚˜, ì–´ë¦°ì•„ì´ë“¤ì˜ ë¶„ë¦¬ìˆ˜ê±° êµìœ¡ ë“±ì— ì‚¬ìš©ë  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤. ë¶€ë”” ì§€êµ¬ë¥¼ ìœ„ê¸°ë¡œë¶€í„° êµ¬í•´ì£¼ì„¸ìš”! ğŸŒ
<br>

## Our team's contributions
```
- Cross Validation - Stratified Goup Fold
- Ensemble ì½”ë“œ
- BiFPN ì¶”ê°€
- Universenet ì¶”ê°€
- YOLOX, YOLOv5
- EfficientDet
```
<br>

## Model Evaluation

### Cross-Validation Strategy

Validation mAPì™€ Public LB scoreì˜ mAPë¥¼ alignì‹œí‚¤ê¸° ìœ„í•´ train setê³¼ validation setì´ ë¹„ìŠ·í•œ class ë¹„ìœ¨ì„ ê°€ì§€ë„ë¡ scikit-learnì—ì„œ ì œê³µí•˜ëŠ” `Stratified Group K Fold`ë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤. ì´ˆë°˜ì— ì‹¤í—˜í• ë•ŒëŠ” Fold 0ìœ¼ë¡œ ì‹¤í—˜ì„ ì§„í–‰í•˜ì˜€ê³  ì„±ëŠ¥ì´ ì¢‹ì€ ë‹¨ì¼ëª¨ë¸ì´ ë‚˜ì˜¤ë©´ ë‹¤ë¥¸ foldì— ì ìš©ì„ í•˜ì—¬ ì¶”í›„ ì•™ìƒë¸” ë‹¨ê³„ì—ì„œ í° ì„±ëŠ¥ í–¥ìƒì„ ê°€ì ¸ë‹¤ì£¼ì—ˆë‹¤. ë˜í•œ í‰ê· ì ìœ¼ë¡œ 20 epochs ì´ë‚´ì— overfittingì´ ë°œìƒí•œë‹¤ëŠ” ê²ƒì„ ê´€ì°°í•˜ê³  validation setì—†ì´ ì „ì²´ foldì— ëŒ€í•´ì„œ í›ˆë ¨ì„ ì§„í–‰í•˜ì˜€ê³  public LBì—ì„œë„ ì¢‹ì€ ê²°ê³¼ë¥¼ ë³´ì˜€ë‹¤.

### 1-stage  

YOLOX, YOLOv5, EfficientDet, Universenet, TOOD, ATSS ë“± ë‹¤ì–‘í•œ 1-stage ëª¨ë¸ë“¤ì„ ì‹œë„í•´ ë³´ì•˜ë‹¤. mmdetection ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì œê³µë˜ì§€ ì•ŠëŠ” ëª¨ë¸ë“¤ì´ ë§ì•„ì„œ í•´ë‹¹ repositoryì—ì„œ ì½”ë“œë¥¼ ê°€ì ¸ì™€ì„œ í›ˆë ¨ì„ ì§„í–‰í•˜ì˜€ë‹¤.

- YOLOX & YOLOv5
YOLOXì™€ YOLOv5ëŠ” ë‹¤ë¥¸ ëª¨ë¸ë“¤ì— ë¹„í•´ì„œ ë¹„êµì  í•™ìŠµì‹œê°„ì´ ì˜¤ë˜ ê±¸ë ¸ì§€ë§Œ 2-stage ëª¨ë¸ë“¤ë³´ë‹¤ LB scoreê°€ ê·¸ë ‡ê²Œ ì¢‹ì§€ ì•Šì•˜ë‹¤. í•˜ì§€ë§Œ 2-stage ëª¨ë¸ë“¤ë³´ë‹¤ ë¹„êµì  small object APê°€ ë†’ì•„ ì•™ìƒë¸”í• ë•Œ ëª¨ë¸ ë‹¤ì–‘ì„±ì— ê¸°ì—¬ë¥¼ í–ˆë‹¤. 

- UniverseNet & ATSS
UniverseNetê³¼ ATSSëŠ” backboneìœ¼ë¡œ Swin-Lì„ ì‚¬ìš©í–ˆì„ ë•Œ, heavy augmentation ì ìš© ì‹œ í•™ìŠµì´ ë˜ì§€ ì•ŠëŠ” í˜„ìƒì´ ë°œìƒí•˜ì˜€ë‹¤. ë”°ë¼ì„œ ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ neck(FPN)ì—ì„œ `start_level`, `add_extra_convs`ë¥¼ ì‚­ì œí•˜ì˜€ë‹¤. ë˜í•œ, ì—°ì‚° ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ fp16ì„ ì ìš©í•˜ì˜€ë‹¤. ê·¸ë¦¬ê³  ë‘ ê²½ìš° ëª¨ë‘ Cascade R-CNNë³´ë‹¤ smallê³¼ mediumì„ ë” ì˜ detect í•˜ì˜€ì§€ë§Œ, mAP50 ê²°ê³¼ëŠ” ì¢‹ì§€ ì•Šì•˜ë‹¤. ë˜í•œ ATSS ëª¨ë¸ì—ì„œ ì¶”ê°€ì ì¸ anchor box ratioë¥¼ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.

- EfficientDet
EfficientDetì€ backboneìœ¼ë¡œ EfficientNet, Neckìœ¼ë¡œ bifpnì„ ì‚¬ìš©í–ˆë‹¤. í•˜ì§€ë§Œ ë‹¤ë¥¸ ëª¨ë¸ë“¤ì— ë¹„í•´ ì¢‹ì€ ì„±ëŠ¥ì„ ë³´ì´ì§€ ëª»í–ˆë‹¤.

- TOOD
ëŒ€íšŒ í›„ë°˜ë¶€ì— TOODëª¨ë¸ì´ ì‘ì€ ë¬¼ì²´ì— ëŒ€í•œ ì„±ëŠ¥ì´ ë§¤ìš° ì¢‹ë‹¤ê³  ë“¤ì–´ì„œ ì ìš©í•´ë´¤ê³  ì‹œë„í•œ ëª¨ë“  ëª¨ë¸ì¤‘ì— smallê³¼ medium objectì— ëŒ€í•œ APê°€ ê°€ì¥ ë†’ì•˜ë‹¤.


### 2-stage
Backbone ëª¨ë¸ì€ ì£¼ë¡œ Swin Transformerë¥¼ ì‚¬ìš©í–ˆë‹¤. ResNetë“± ë‹¤ë¥¸ backboneë“¤ì„ ì‹œë„í•´ë³´ì•˜ì§€ë§Œ íŠ¸ëœìŠ¤í¬ë¨¸ ê¸°ë°˜ì´ ê°€ì¥ ì„±ëŠ¥ì´ ìš°ìˆ˜í–ˆë‹¤. Neck ìœ¼ë¡œëŠ” FPN, PAFPN, BiFPN ë“±ì„ ì‹œë„í–ˆì§€ë§Œ ì„±ëŠ¥ ì°¨ì´ëŠ” í¬ì§€ ì•Šì•˜ë‹¤. Detector ëª¨ë¸ì€ Cascade RCNN, Faster RCNN ë¥¼ ì‹œë„í–ˆëŠ”ë° Cascade RCNNì˜ ì„±ëŠ¥ì´ ì¡°ê¸ˆ ë” ì¢‹ì•˜ë‹¤. EDAë¥¼ ì§„í–‰í•˜ë©° objectì˜ box ratio ë¶„í¬ê°€ ë‹¤ì–‘í•˜ë‹¤ëŠ”ê±¸ ê´€ì°°í–ˆê³  ê¸°ì¡´ì˜ ë² ì´ìŠ¤ë¼ì¸ì— ìˆë˜ anchor box ratio 0.5, 1, 2.0 ì™¸ì— 0.7ê³¼ 1.5ë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤. ë˜í•œ class imbalanceë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ ì˜ˆì¸¡í•˜ê¸° í˜ë“  ë¬¼ì²´ì— ë” í¬ì»¤ìŠ¤ë¥¼ ë‘ëŠ” focal lossë¥¼ Cascade R-CNNì— ì ìš©í–ˆê³  ê·¸ ê²°ê³¼ ë‹¨ì¼ ëª¨ë¸ ì„±ëŠ¥ì´ ê°€ì¥ ì¢‹ì•˜ë‹¤.

### Heavy Augmentation
Classification taskì— ë¹„í•´ì„œ translation variance ë¬¸ì œê°€ ì¤‘ìš”í•œ object detection taskì—ì„œëŠ” ëª¨ë¸ì˜ capacityë¥¼ í‚¤ì›Œì£¼ëŠ”ê²ƒì´ ì¤‘ìš”í•˜ë‹¤ê³  íŒë‹¨í–ˆë‹¤. ë˜í•œ Kaggleë“± ëŒ€íšŒ ìˆ˜ìƒìë“¤ì˜ discussionì„ ì‚´í´ë³´ì•˜ì„ë•Œ heavy augmentationì´ ì¢‹ì€ ê²°ê³¼ë¥¼ ê°€ì ¸ë‹¤ ì¤€ë‹¤ëŠ”ê²ƒì„ ì•Œì•˜ê³  ì´ë²ˆ ëŒ€íšŒì—ì„œ heavy augmentationì„ ì ìš©í•œ ê²°ê³¼ ì„±ëŠ¥ í–¥ìƒì„ ê°€ì ¸ë‹¤ì£¼ì—ˆë‹¤. Albumentation ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì˜€ê³  ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©í•œ augmentation ê¸°ë²•ì€ ì•„ë˜ì™€ ê°™ë‹¤.

```
1. ShiftScaleRotate
2. RandomBrightnessContrast
3. RGBShift
4. HueSaturationValue
5. JpegCompression
6. ChannelShuffle
7. MedianBlur
8. CLAHE
```

## Ensemble    
ì²˜ìŒì—ëŠ” NMSì™€ Soft-NMSë¥¼ ì´ìš©í•´ ì•™ìƒë¸”ì„ í–ˆê³  
ã„¹ë‹¨ì¼ ëª¨ë¸


## Conclusion



## Experiments
| Index | Property | Name | LB Score | Submitter | Date |
| --- | --- | --- | --- | --- | --- |
| 1 | Single-2stage | Cascade R-CNN / Swin L / FPN / fold0 / inf 800 | 0.6177 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/03/29 |
| 2 | Single-2stage | Cascade R-CNN / Swin L / FPN / fold0 / inf 1024 | 0.6205 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/03/29 |
| 3 | Ensemble | 01 / 02 / inf 800, 1024 // nms 0.55 | 0.6423 | ì´ì°½ì§„ ìº í¼ | 2022/03/29 |
| 4 | Single-2stage | Cascade R-CNN / Swin L / PAFPN / fold1 / Train 1024 / inf 1024 | 0.6157 | ì´ì°½ì§„ ìº í¼ | 2022/03/30 |
| 5 | Single-2stage | Cascade R-CNN / Swin L / PAFPN / fold0 / Train 800 / inf 800 | 0.607 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/03/30 |
| 6 | Single-2stage | Cascade R-CNN / Swin L / PAFPN / fold0 / Train 800 / inf 1024 | 0.6104 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/03/30 |
| 7 | Ensemble | 01 / 02 / 05 / 06 // nms 055 | 0.6472 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/03/30 |
| 8 | Ensemble | 01 / 02 / 05 / 06 / YoloX / WBF 0.55 skip 0.1 | 0.6324 |  | 2022/03/30 |
| 9 | Ensemble | 01 / 02 / 05 / 06 / YoloX / nms 0.55 | 0.6361 |  | 2022/03/30 |
| 10 | Ensemble | 14ê°œ ëª¨ë¸ / WBF 055, skip 0.1 | 0.6813 | ì´ì°½ì§„ ìº í¼ | 2022/03/31 |
| 11 | Ensemble | 16ê°œ ëª¨ë¸ / WBF 05, skip 0.08 | 0.685 | ì´ì°½ì§„ ìº í¼ | 2022/03/31 |
| 12 | Single-2stage | Cascade R-CNN / Swin L / FPN / fold1 / inf 1024 |  |  | 2022/03/31 |
| 13 | Single-2stage | Cascade R-CNN / Swin L / FPN / fold2 / inf 1024 |  |  | 2022/03/31 |
| 14 | Ensemble | 01 / 02 / 12-1 / 12-2 / 13 // nms 055 | 0.6539 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/03/31 |
| 15 | Single-2stage | Faster_RCNN / Swin_L / FPN / fold0 / inf 512 | 0.5843 | ì‹¬ì¤€êµ ìº í¼ | 2022/03/28 |
| 16 | Single-2stage | Faster_RCNN / Swin_L / PAFPN / fold0 / inf 1024 | 0.6241 | ì‹¬ì¤€êµ ìº í¼ | 2022/04/01 |
| 17 | Single-2stage | Faster_RCNN / Swin_L / PAFPN / fold0 / inf 800 |  | ì‹¬ì¤€êµ ìº í¼ | 2022/04/01 |
| 18 | Ensemble | 22ê°œ ëª¨ë¸ / WBF 0.5, skip 0.1 | 0.6894 | ì´ì°½ì§„ ìº í¼ | 2022/04/01 |
| 19 | Ensemble | 23ê°œ ëª¨ë¸ / WBF 0.55, skip 0.1 | 0.6914 | ì´ì°½ì§„ ìº í¼ | 2022/04/01 |
| 20 | Ensemble | 23ê°œ ëª¨ë¸ / WBF 0.6, skip 0.1 | 0.6904 | ì´ì°½ì§„ ìº í¼ | 2022/04/01 |
| 21 | Ensemble | 23ê°œ ëª¨ë¸ / WBF 0.4, skip 0.1 | 0.6778 | ì´ì°½ì§„ ìº í¼ | 2022/04/01 |
| 22 | Ensemble | 23ê°œ ëª¨ë¸ / WBF 0.55, skip 0.08 | 0.6931 | ì´ì°½ì§„ ìº í¼ | 2022/04/01 |
| 23 | Ensemble | 23ê°œ ëª¨ë¸ / WBF 0.55, skip 0.06 | 0.6945 | ì´ì°½ì§„ ìº í¼ | 2022/04/01 |
| 24 | Single-2stage | Faster_RCNN / Swin_L / PAFPN / fold0 / inf1024 + outlier ì œê±°  | 0.5962 | ì´ì°½ì§„ ìº í¼ | 2022/04/02 |
| 25 | Ensemble | Multi-stage Ensemble | 0.676 | ì´ì°½ì§„ ìº í¼ | 2022/04/02 |
| 26 | Ensemble | 25ê°œ ëª¨ë¸ / WBF 0.55, skip 0.1 / model_weights | 0.6931 | ì´ì°½ì§„ ìº í¼ | 2022/04/02 |
| 27 | Ensemble | 25ê°œ ëª¨ë¸ / WBF 0.55, skip 0.06 |  |  | 2022/04/02 |
| 28 | Ensemble | 27ê°œ ëª¨ë¸ / WBF 0.55, skip 0.05 |  |  | 2022/04/02 |
| 29 | Ensemble | 27ê°œ ëª¨ë¸ / WBF 0.55, skip 0.05 / model_weights | 0.6984 | ì´ì°½ì§„ ìº í¼ | 2022/04/02 |
| 30 | Single-1stage | Yolov5 | 0.5468 | ê¹€í•˜ì¤€ ìº í¼ | 2022/04/04 |
| 31 | Single-1stage | Yolov5 | 0.5907 | ê¹€í•˜ì¤€ ìº í¼ | 2022/04/05 |
| 32 | Single-1stage | ATSS / Swin-L / FPN | 0.5563 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/03/28 |
| 33 | Single-2stage | Cascade R-CNN / Swin-L / FPN / bbox head / full | 0.6246 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/04/04 |
| 34 | Single-2stage | Cascade R-CNN / Swin-L / FPN / focal loss / fold0 | 0.6243 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/04/04 |
| 35 | Single-2stage | Cascade R-CNN / Swin-L / FPN / focal loss / full | 0.6368 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/04/04 |
| 36 | Single-1stage | UniverseNet / Swin-L / FPN+SEPC / fold0 | 0.5684 | ìœ ìŠ¹ë¦¬ ìº í¼ | 2022/04/05 |
